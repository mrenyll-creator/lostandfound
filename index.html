<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost and Found</title>
    <style>
body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    color: #333333;
    overflow-x: hidden;
    position: relative;
}

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.8);
    z-index: -1;
}

#particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
}

.particle {
    position: absolute;
    background-color: #cccccc;
    border-radius: 50%;
    animation: float 10s infinite linear;
}

@keyframes float {
    0% { transform: translateY(100vh) rotate(0deg); }
    100% { transform: translateY(-100vh) rotate(360deg); }
}

@keyframes fadeInZoom {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

.fade-in-zoom {
    animation: fadeInZoom 1s ease-in-out;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.page h1.fade-in-zoom {
    font-family: 'Brush Script MT', cursive;
    font-size: 60px;
    text-align: center;
}

.page p.fade-in-zoom {
    text-align: center;
    font-size: 24px;
}

header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 20px;
    background-color: #f8f8f8;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    position: relative;
}

#nav ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
}

#nav li {
    margin-right: 20px;
}

#nav a {
    text-decoration: none;
    color: #333333;
    font-size: 18px;
    font-weight: bold;
    padding: 10px 15px;
    border-radius: 5px;
    border: 2px solid #cccccc;
    transition: all 0.3s;
}

#nav a:hover, #nav a.active {
    background-color: #cccccc;
    color: #333333;
    transform: scale(1.05);
}

#auth {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: flex-end;
}

button {
    padding: 10px 20px;
    background-color: #333333;
    color: #ffffff;
    border: none;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
}

button:hover {
    background-color: #666666;
}

main {
    padding: 40px;
    max-width: 1200px;
    margin: 0 auto;
}

.page {
    display: none;
}

.page.active {
    display: block;
}

h1 {
    font-size: 36px;
    margin-bottom: 20px;
}

p {
    font-size: 18px;
    line-height: 1.6;
}

.item {
    border: 1px solid #cccccc;
    padding: 20px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
}

.item img {
    max-width: 200px;
    margin-right: 20px;
}

.item h3 {
    margin: 0 0 10px 0;
}

.item p {
    margin: 0;
}

.search-container {
    position: absolute;
    top: 0;
    right: 0;
}

.search-container input {
    padding: 8px 12px;
    font-size: 16px;
    border: 2px solid #cccccc;
    border-radius: 10px;
    width: 200px;
}

.page {
    position: relative;
}

.item {
    opacity: 0;
}

@keyframes fadeIn {
    0% {
        opacity: 0;
        transform: translateY(20px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

#item-form {
    margin-bottom: 40px;
}

#item-form input, #item-form textarea {
    display: block;
    width: 100%;
    margin-bottom: 10px;
    padding: 10px;
    font-size: 16px;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 400px;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover {
    color: black;
}

#login-form, #register-form {
    display: flex;
    flex-direction: column;
}

#login-form input, #register-form input {
    margin-bottom: 10px;
    padding: 10px;
}

.end-message {
    text-align: center;
    padding: 20px;
    font-size: 18px;
    color: #666;
    display: none;
    transition: transform 0.3s;
}

.end-message:hover {
    transform: scale(1.05);
}
    </style>
</head>
<body>
    <div id="particles"></div>
    <header>
        <nav id="nav">
            <ul>
                <li><a href="#" onclick="showPage('home')">Home</a></li>
                <li><a href="#" onclick="showPage('about')">About</a></li>
                <li><a href="#" onclick="showPage('claimed')">Claimed Items</a></li>
                <li><a href="#" onclick="showPage('lost')">Lost Items</a></li>
                <li id="admin-link" style="display:none;"><a href="#" onclick="showPage('admin')">Admin Panel</a></li>
            </ul>
        </nav>
        <div id="auth">
            <button id="login-btn" onclick="showLogin()">Login</button>
            <button id="register-btn" onclick="showRegister()">Register</button>
            <button id="logout-btn" style="display:none;" onclick="logout()">Logout</button>
        </div>
    </header>

    <main>
        <div id="home" class="page active">
            <h1 class="fade-in-zoom">Welcome to Lost and Found</h1>
            <p class="fade-in-zoom">Help reunite lost items with their owners.</p>
        </div>
        <div id="about" class="page">
            <h1 class="fade-in-zoom">About Our System</h1>
            <p class="fade-in-zoom">This system helps manage lost and found items efficiently.</p>
        </div>
        <div id="claimed" class="page">
            <h1 class="fade-in-zoom">Claimed Items</h1>
            <div class="search-container">
                <input type="text" id="claimed-search" placeholder="Search claimed items..." onkeyup="filterItems('claimed')">
            </div>
            <div id="claimed-items"></div>
        </div>
        <div id="lost" class="page">
            <h1 class="fade-in-zoom">Lost Items</h1>
            <div class="search-container">
                <input type="text" id="lost-search" placeholder="Search lost items..." onkeyup="filterItems('lost')">
            </div>
            <div id="lost-items"></div>
        </div>
        <div id="admin" class="page">
            <h1 class="fade-in-zoom" style="font-family: 'Brush Script MT', cursive; font-size: 60px; text-align: center;">Admin Panel</h1>
            <form id="item-form">
                <input type="text" id="item-name" placeholder="Item Name" required>
                <textarea id="item-desc" placeholder="Description" required></textarea>
                <input type="file" id="item-photo" accept="image/*" required>
                <button type="submit">Add Lost Item</button>
            </form>
            <div id="admin-items"></div>
        </div>
    </main>

    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Login</h2>
            <form id="login-form">
                <input type="text" id="username" placeholder="Username" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
        </div>
    </div>

    <div id="register-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Register</h2>
            <form id="register-form">
                <input type="text" id="reg-username" placeholder="Username" required>
                <input type="password" id="reg-password" placeholder="Password" required>
                <button type="submit">Register</button>
            </form>
        </div>
    </div>

    <script>
const API_BASE = (window.location.protocol === 'file:' || window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') ? 'http://localhost:8000/api' : `${window.location.protocol}//${window.location.hostname}${window.location.port ? ':' + window.location.port : ''}/api`;
let currentUser = null;
let items = [];

document.addEventListener('DOMContentLoaded', function() {
    createParticles();
    showPage('home');
    updateUI();
    loadItems();
});

function createParticles() {
    const particlesContainer = document.getElementById('particles');
    for (let i = 0; i < 50; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.width = Math.random() * 10 + 5 + 'px';
        particle.style.height = particle.style.width;
        particle.style.animationDelay = Math.random() * 10 + 's';
        particlesContainer.appendChild(particle);
    }
}

function showPage(pageId) {
    const pages = document.querySelectorAll('.page');
    pages.forEach(page => page.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');

    // Update nav active state
    const navLinks = document.querySelectorAll('#nav a');
    navLinks.forEach(link => link.classList.remove('active'));
    const activeLink = document.querySelector(`#nav a[onclick="showPage('${pageId}')"]`);
    if (activeLink) activeLink.classList.add('active');
}

function showLogin() {
    document.getElementById('login-modal').style.display = 'block';
}

function showRegister() {
    document.getElementById('register-modal').style.display = 'block';
}

function closeModal() {
    document.getElementById('login-modal').style.display = 'none';
    document.getElementById('register-modal').style.display = 'none';
}

document.getElementById('login-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    try {
        const response = await fetch(`${API_BASE}/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });
        const ctype = response.headers.get('content-type') || '';
        if (ctype.includes('application/json')) {
            const data = await response.json();
            if (data.success) {
                currentUser = { id: data.user_id, username, role: data.role };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUI();
                closeModal();
                showPage(data.role === 'admin' ? 'admin' : 'home');
            } else {
                alert(data.message || 'Login failed');
            }
        } else {
            const text = await response.text();
            console.error('Non-JSON response from /api/login:', response.status, text);
            alert('Login failed: server returned non-JSON response:\n' + text);
        }
    } catch (error) {
        alert('Login failed: ' + error.message);
    }
});

document.getElementById('register-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const username = document.getElementById('reg-username').value;
    const password = document.getElementById('reg-password').value;

    try {
        const response = await fetch(`${API_BASE}/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });
        const ctype = response.headers.get('content-type') || '';
        if (ctype.includes('application/json')) {
            const data = await response.json();
            if (data.success) {
                alert('Registration successful. Please login.');
                closeModal();
            } else {
                alert(data.message || 'Registration failed');
            }
        } else {
            const text = await response.text();
            console.error('Non-JSON response from /api/register:', response.status, text);
            alert('Registration failed: server returned non-JSON response:\n' + text);
        }
    } catch (error) {
        alert('Registration failed: ' + error.message);
    }
});

function logout() {
    currentUser = null;
    localStorage.removeItem('currentUser');
    updateUI();
    showPage('home');
}

function updateUI() {
    const loginBtn = document.getElementById('login-btn');
    const registerBtn = document.getElementById('register-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const adminLink = document.getElementById('admin-link');
    
    if (currentUser) {
        loginBtn.style.display = 'none';
        registerBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        if (currentUser.role === 'admin') {
            adminLink.style.display = 'block';
        }
    } else {
        loginBtn.style.display = 'inline-block';
        registerBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        adminLink.style.display = 'none';
    }
}

document.getElementById('item-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    if (currentUser && currentUser.role === 'admin') {
        const name = document.getElementById('item-name').value;
        const description = document.getElementById('item-desc').value;
        const photoFile = document.getElementById('item-photo').files[0];

        const reader = new FileReader();
        reader.onload = async function(e) {
            const photo = e.target.result;

            try {
                const response = await fetch(`${API_BASE}/items`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description, photo, status: 'lost' })
                });
                const data = await response.json();

                if (data.success) {
                    loadItems();
                    document.getElementById('item-form').reset();
                } else {
                    alert('Failed to add item: ' + data.message);
                }
            } catch (error) {
                alert('Failed to add item: ' + error.message);
            }
        };
        reader.readAsDataURL(photoFile);
    }
});

async function loadItems() {
    try {
        const response = await fetch(`${API_BASE}/items`);
        const ctype = response.headers.get('content-type') || '';
        if (ctype.includes('application/json')) {
            items = await response.json();
        } else {
            const text = await response.text();
            console.error('Non-JSON response from /api/items:', response.status, text);
            throw new Error('Server returned non-JSON response: ' + (text && text.substring(0,200)));
        }

        const claimedContainer = document.getElementById('claimed-items');
        const lostContainer = document.getElementById('lost-items');
        const adminContainer = document.getElementById('admin-items');

        claimedContainer.innerHTML = '';
        lostContainer.innerHTML = '';
        adminContainer.innerHTML = '';

        items.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item';
            itemDiv.innerHTML = `
                <img src="${item.photo || ''}" alt="${item.name}">
                <div>
                    <h3>${item.name}</h3>
                    <p>${item.description}</p>
                    <p>Status: ${item.status}</p>
                </div>
            `;

            if (item.status === 'claimed') {
                claimedContainer.appendChild(itemDiv);
            } else {
                lostContainer.appendChild(itemDiv);
            }

            if (currentUser && currentUser.role === 'admin') {
                const adminItemDiv = itemDiv.cloneNode(true);
                const statusBtn = document.createElement('button');
                statusBtn.textContent = item.status === 'lost' ? 'Mark as Claimed' : 'Mark as Lost';
                statusBtn.onclick = () => toggleStatus(item.id);
                statusBtn.style.display = 'block';
                adminItemDiv.appendChild(statusBtn);

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.onclick = () => deleteItem(item.id);
                deleteBtn.style.display = 'block';
                deleteBtn.style.marginTop = '10px';
                adminItemDiv.appendChild(deleteBtn);

                adminContainer.appendChild(adminItemDiv);
            }
        });

        // Handle empty containers
        if (claimedContainer.children.length === 0) {
            const noClaimed = document.createElement('div');
            noClaimed.textContent = "No claimed items";
            noClaimed.style.textAlign = 'center';
            noClaimed.style.padding = '20px';
            noClaimed.style.fontSize = '18px';
            noClaimed.style.color = '#666';
            claimedContainer.appendChild(noClaimed);
        } else {
            // Add end message for claimed items
            const claimedEndMessage = document.createElement('div');
            claimedEndMessage.className = 'end-message';
            claimedEndMessage.textContent = "You've reached the end";
            claimedEndMessage.style.textAlign = 'center';
            claimedEndMessage.style.padding = '20px';
            claimedEndMessage.style.fontSize = '18px';
            claimedEndMessage.style.color = '#666';
            claimedEndMessage.style.display = 'none';
            claimedContainer.appendChild(claimedEndMessage);
        }

        if (lostContainer.children.length === 0) {
            const noLost = document.createElement('div');
            noLost.textContent = "No lost items";
            noLost.style.textAlign = 'center';
            noLost.style.padding = '20px';
            noLost.style.fontSize = '18px';
            noLost.style.color = '#666';
            lostContainer.appendChild(noLost);
        } else {
            // Add end message for lost items
            const lostEndMessage = document.createElement('div');
            lostEndMessage.className = 'end-message';
            lostEndMessage.textContent = "You've reached the end";
            lostEndMessage.style.textAlign = 'center';
            lostEndMessage.style.padding = '20px';
            lostEndMessage.style.fontSize = '18px';
            lostEndMessage.style.color = '#666';
            lostEndMessage.style.display = 'none';
            lostContainer.appendChild(lostEndMessage);
        }

        observeItems(); // Re-observe after loading
        addScrollListeners(); // Add scroll listeners for end messages
    } catch (error) {
        console.error('Failed to load items:', error);
    }
}

async function toggleStatus(id) {
    try {
        const response = await fetch(`${API_BASE}/items/${id}/status`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' }
        });
        const data = await response.json();

        if (data.success) {
            loadItems();
        } else {
            alert('Failed to update status: ' + data.message);
        }
    } catch (error) {
        alert('Failed to update status: ' + error.message);
    }
}

async function deleteItem(id) {
    if (confirm('Are you sure you want to delete this item?')) {
        try {
            const response = await fetch(`${API_BASE}/items/${id}`, {
                method: 'DELETE'
            });
            const data = await response.json();

            if (data.success) {
                loadItems();
            } else {
                alert('Failed to delete item: ' + data.message);
            }
        } catch (error) {
            alert('Failed to delete item: ' + error.message);
        }
    }
}

// Load current user on page load
const savedUser = localStorage.getItem('currentUser');
if (savedUser) {
    currentUser = JSON.parse(savedUser);
}

function filterItems(status) {
    const searchInput = document.getElementById(`${status}-search`);
    const filter = searchInput.value.toLowerCase();
    const container = document.getElementById(`${status}-items`);
    const items = container.getElementsByClassName('item');
    let hasVisible = false;

    for (let i = 0; i < items.length; i++) {
        const itemName = items[i].getElementsByTagName('h3')[0].textContent.toLowerCase();
        const itemDesc = items[i].getElementsByTagName('p')[0].textContent.toLowerCase();

        if (itemName.includes(filter) || itemDesc.includes(filter)) {
            items[i].style.display = '';
            hasVisible = true;
        } else {
            items[i].style.display = 'none';
        }
    }

    // Handle no results message
    let noResults = container.querySelector('.no-results');
    if (!hasVisible) {
        if (!noResults) {
            noResults = document.createElement('div');
            noResults.className = 'no-results';
            noResults.textContent = 'No results found';
            noResults.style.textAlign = 'center';
            noResults.style.padding = '20px';
            noResults.style.fontSize = '18px';
            noResults.style.color = '#666';
            container.appendChild(noResults);
        }
    } else {
        if (noResults) {
            noResults.remove();
        }
    }

    // Re-observe items after filtering
    observeItems();
}

// Intersection Observer for fade-in animation on scroll
const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
            setTimeout(() => {
                entry.target.style.animation = 'fadeIn 1s ease-in-out forwards';
            }, index * 200); // Stagger the animations
        }
    });
}, observerOptions);

// Observe all items
function observeItems() {
    const items = document.querySelectorAll('.item');
    items.forEach(item => observer.observe(item));
}

// Call observeItems after loading items
document.addEventListener('DOMContentLoaded', function() {
    createParticles();
    showPage('home');
    updateUI();
    loadItems();
    observeItems();
});

// Add scroll listeners for end messages
function addScrollListeners() {
    const claimedContainer = document.getElementById('claimed-items');
    const lostContainer = document.getElementById('lost-items');

    const claimedEndMessage = claimedContainer.querySelector('.end-message');
    const lostEndMessage = lostContainer.querySelector('.end-message');

    if (claimedEndMessage) {
        claimedContainer.addEventListener('scroll', () => {
            if (claimedContainer.scrollTop + claimedContainer.clientHeight >= claimedContainer.scrollHeight - 10) {
                claimedEndMessage.style.display = 'block';
            }
        });
    }

    if (lostEndMessage) {
        lostContainer.addEventListener('scroll', () => {
            if (lostContainer.scrollTop + lostContainer.clientHeight >= lostContainer.scrollHeight - 10) {
                lostEndMessage.style.display = 'block';
            }
        });
    }
}

    </script>
</body>
</html>
